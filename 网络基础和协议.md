---

typora-root-url: ./
typora-copy-images-to: img
---

# 计算机网络

## 基本

* 概念：计算机网络是一个将分散的、具有独立功能的**计算机系统**，通过**通信设备**与**线路**连接起来，有功能完善的<u>软件</u>实现**资源共享**和**信息传递**的系统。
* 计算机网络是互联的、自治的计算机集合。

主要的5个作用：

1. 数据通信（连通性）
2. 资源共享（硬件、软件、数据）
3. 分布式处理
4. 提高可靠性
5. 负载均衡

* 组成（硬件、软件、协议）

  工作方式：

  1. 边缘部分（用户直接使用）
  2. 核心部分（为边缘部分服务）

  功能组成：

  1. 通信子网（实现数据通信）
  2. 资源子网（实现资源共享/数据处理）

  一般来说资源子网包括：应用层、表示层、会话层

  通信子网包括网络层、数据链路层、物理层。
  
* 分类

  1. 按分布范围分：
     1. 广域网WAN（交换技术）
     2. 城域网MAN
     3. 局域网WAN（广播技术）
     4. 个人局域网PAN
  2. 按使用者分：
     1. 公用网
     2. 专用网
  3. 按交换技术分
     1. 电路交换
     2. 报文交换
     3. 分组交换
  4. 按拓扑结构分：
     1. 总线型
     2. 星型
     3. 环形
     4. 网状型（用于广域网）
  5. 按传输技术分：
     1. 广播式网络（共享公共通信信道）
     2. 点对点网络（使用分组存储转发和路由选择技术）

### 标准化工作和相关组织

标准的分类：

1. 法定标准（OSI）
2. 事实标准（TCPIP）

RFC(Request For Comments)——因特网标准的形式

1. 因特网草案
2. 建议标准
3. 草案标准（请求评论）
4. 因特网标准

相关组织：

1. 国际标准化组织ISO
2. 国际电信联盟ITU
3. 国际电气电子工程师协会IEEE
4. IETF

### 性能指标

* 速率

* 带宽（网络设备所支持的最高速度）

* 吞吐量

* 时延

  发送时延：数据长度/信道带宽

  传播时延：信道长度/电磁波在信道上的传播速率

  排队时延

  处理时延

  *高速链路减少的是发送时延*

* 时延带宽积：传播时延*带宽（以bit为单位的链路长度）

* 往返时间RTT

  从发送方发送数据开始，到发送方收到接收方的确认总共经历的时延。

  RTT包括往返的传播时延=传播时延*2 和 末端处理时间

* 利用率

  1. 信道利用率

     有数据通过的时间/总时间

  2. 网络利用率

     信道利用率加权平均值

### 分层结构

分层的基本原则：

1. 各层之间相互独立，每次只实现一种相对独立的功能。
2. 每层之间界面自然清晰，易于理解，相互交流尽可能少。
3. 结构上可分割开，每层都采用最合适的技术来实现。
4. 保持下层对上层的独立性，**上层单项使用下层提供的服务**。
5. 整个分层结构应该能够促进标准化工作。

几个概念：

1. 实体：第n层中的活动元素称为**n层实体**。同一层的实体叫做**对等实体**。
2. 协议：为进行网络中的**对等实体**数据交换而建立的规则、标准或约定称为网络协议【水平】
   1. 语法：规定传输数据的格式
   2. 语义规定所要完成的功能
   3. 同步：规定各种操作的顺序
3. 接口（访问服务点SAP）：上层使用下层服务的入口。
4. 服务：下层为相邻上层提供的功能调用。【垂直】
5. SDU服务数据单元：为完成用户所要求的功能而应传送的数据。
6. PCI协议控制信息：控制协议操作的信息
7. PDU协议数据单元：对等层次之间传送的数据单位。![image-20211005143442592](/img/image-20211005143442592.png)



# HTTP协议

web应用层：
	http/https:
		协议:
			tcp-->80端口
			https-->443端口
		状态码:
			2xx-->成功
			3xx-->重定向
			4xx-->客户端问题
			5xx-->服务器问题
websocket:



# Tcp/ip协议：

### 链路层协议

1. 802.3

2. **以太网协议(常用)**(RFC894)

   目的地址(6bytes)+源地址(6bytes)+**类型（2bytes）**+【数据（46-1500bytes）】+CRC（4bytes）

   类型：

   0800 -> IP数据报

   0806 -> ARP请求应答

   8035 -> RARP请求应答

MTU(最大传输单元)

### IP

```bash
# windows
netstat -an
netstat -r 查看路由表
# linux
ifconfig eth0 1.2.3.4 netmask 255.255.255.0
```

#### ip头部

最大长度60bytes

基本的头部长度是20bytes，可以加40bytes的选项。

```
4bit 版本号	4bit 首部长度
8bit 服务类型(基本没用，看路由器)
16bit 总长度（字节数）

# 下面这部分可能会因为分片而改变（详细见下方IP分片部分）
16bit 标识（用于分辨这是哪个数据包，因为可能存在分片）
3bit 标志（第一个位df是如果包大小大于MTU就直接丢弃，然后说明原因；第二个位mf是还有more包，用于分片）	
13bit 片偏移（用于组装包）

8bit 生存时间（TTL，每过一个路由--）
8bit协议 用于内容是什么协议（ICMP、TCP、UDP等等）
16bit 首部校验和
32bit 源ip	32bit 目的ip
[最大40bytes的选项]
```

协议（8bit）：

1. icmp - 1
2. tcp - 6
3. udp - 17

特殊的ip地址

1. 0.0.0.0 可以为源，不能为目的（例：DHCP（udp））
2. 127.xx.xx.xx 环回地址
3. 255.255.255.255 受限的广播
4. 一些奇怪的广播，主机号都是255

### ARP

0806

#### arp代理

无路由能力，直接发arp请求。

需要在路由器上启用代理arp请求。思科默认有。

#### 免费arp

重新配置ip地址之后，机器会自动发送免费arp来确认网络中是否有重复的ip地址。

就是发一个arp请求，问一问这个ip有没有回应。

通过免费arp会让网络中其他机子更新arp缓存。

### ICMP

icmp报文跟在ip首部后面。

> 8bit类型+8bit代码+16bit校验和+报文【标识符+序号+选项数据】

#### 报文类型

基本上分为两类：查询报文和差错报文。

0 0: 回显应答 (ping应答)

3 x: 不可达(很重要)

5 x: 重定向

8 0: 请求回显（ping）

11 x: 超时（TTL--减没了）

> 如果出现问题，路由器回送Unreachable给端口应用程序进程。
>
> 发送的差错报文始终包含**错的那个包的IP首部**和IP数据报的前8个字节【包含了**端口号**】。
>
> 原主机基于端口号将差错报文交给应用程序。

不会产生差错报文的情况：

> 1. 差错报文不会产生差错报文
> 2. 目的地址是广播或多播
> 3. 作为链路层广播的数据报
> 4. 不是IP分片的第一片（后面的分片没有端口号信息，所以没用）
> 5. 源地址不是单个主机的数据包（零地址、环回地址、广播或多播地址）
>

#### IP记录路由选项

ping -R (双向的)

ping -T

#### Traceroute

> 不是所有的路由器都支持记录路由选项
>
> Traceroute是单向的
>
> 在windows下是tracert

##### TTL字段

如果ttl为0/1则发送icmp的超时信息

traceroute用的是udp的包（TTL=1），选择一个不可能的端口号(>33434)作为目的端口号，然后一跳一跳的走，并且增加ttl，直到到达目标主机，收到端口不可达差错报文。

tracert用的icmp包直接等超时，直到到达。

> 防火墙ttl不减少，所以看不到防火墙

#### IP源站路由

逐跳改变目的IP地址

![image-20220320173505922](/img/image-20220320173505922.png)

> 禁用源站路由： no ipsource-route

#### IP选路

xxx

ICMP重定向可以更新路由表

### UDP

![image-20220320175448038](/img/image-20220320175448038.png)

> udp会直接封装udp头部，不会管大小，直接发。
>
> 如果超过MTU大小就会IP分片

![image-20220321130409860](/img/image-20220321130409860.png)

#### UDP检验和

包括UDP首部和UDP数据，UDP的检验和是可选的，TCP是必须的。

IP首部的检验和只包括IP的首部。

细节如下图：

![image-20220321130813827](/img/image-20220321130813827.png)

#### IP分片

出接口判断MTU

分片可能发生在路由器或者源主机上

分片对于传输层是透明的

对于TCP，如果丢了一个分片，就要全部重传。

在分片时，除了最后一片，其他每一片的数据部分必须是8bytes的整数倍。

![image-20220321131757103](/img/image-20220321131757103.png)

#### ICMP不可达差错(需要分片)

![image-20220326160141473](/img/image-20220326160141473.png)

类型为3，代码为4.

9:14







# 研1计网复习

```
第一章 概述
	网络的定义、分类、拓扑结构
	云计算服务的部署形式
	google云计算的关键技术
	GFS的组成、MapReduce的实现机制，如何实现容错
	分层的意义，通信子网/资源子网
	ISO/OSI RM每层的基本功能
	TCP/IP的分层，各种错误发生的层次
	
第二章 局域网
	标准以太网CSMA/CD工作原理，最小帧长度10ME帧格式
	千兆以太网的帧突发、Pause帧的作用
	百兆、干兆、万兆以太网(全双工)的物理层编码方式
	透明网桥的工作原理
	源站选路网桥的工作原理
	VLAN
	划分依据
	Access\Trunk\端口
	VLAN帧在转发中的变化
	GVRP
	VLAN路由的三种实现方式
	MPLS
	标签相关
	MPLS BGP VPN
	
第三章 网络层
	IP地址的分配
	IPv4报文格式
	IPv6地址、扩展报头
	路由协议（RIP/OSPF/BGP）
	多播
	
第四章 传输层
	TCP可靠传输
	QUIC基于UPD的可靠传输
	
第五章 SDN
	SDN体系结构：分层的名称、各层的功能
	特征：转控分离、集中控制、开放接口
	OpenFlow的流表匹配规则
	
```

